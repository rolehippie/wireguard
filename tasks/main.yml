# Standards: 0.1
---
- name: Add ppa repository
  apt_repository:
    repo: ppa:wireguard/wireguard
    filename: wireguard
    update_cache: True
    state: present
  tags:
    - wireguard

- name: Install required packages
  with_items:
    - bridge-utils
    - openresolv
    - linux-headers-generic
    - wireguard-dkms
    - wireguard-tools
  package:
    name: "{{ item }}"
    state: present
  tags:
    - wireguard

- name: Write config file
  notify:
    - Restart wireguard
  template:
    src: config.j2
    dest: "/etc/wireguard/{{ wireguard_interface }}.conf"
    mode: u=rw,g=,o=
  tags:
    - wireguard

- name: Start wireguard service
  systemd:
    name: "wg-quick@{{ wireguard_interface }}"
    state: started
    daemon_reload: True
    masked: False
    enabled: True
  tags:
    - wireguard

...
